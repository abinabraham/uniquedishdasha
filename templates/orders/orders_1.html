{% load form_tags %}
{% load static %}<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dishdasha | Create Order</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        label.error{
            color:red !important;
        }
    </style>
</head>
<body>
    {% get_fbtype as fbtype %}
    {% get_tailoringstyle as tailstyle %}
    {% get_colors as colors %}

    
    {% include "common/header.html" %}


    <div class="container">
        <div class="orderFlowWrap">
            <div class="orderFlow">
                <div class="row">
                    <div class="col-12">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="customer-tab" data-bs-toggle="tab"
                                    data-bs-target="#customerSection" type="button" role="tab" aria-controls="home"
                                    aria-selected="true">
                                    Customer Details
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link btn_next_step1" id="order-tab" data-bs-toggle="tab"
                                    data-bs-target="#orderSection" type="button" role="tab" aria-controls="profile"
                                    aria-selected="false">
                                    Order Details
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link btn_next_step2" id="measurement-tab" data-bs-toggle="tab"
                                    data-bs-target="#measurementSection" type="button" role="tab"
                                    aria-controls="contact" aria-selected="false">
                                    Measurement
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link btn_next_step3" id="summary-tab" data-bs-toggle="tab"
                                    data-bs-target="#summarySection" type="button" role="tab" aria-controls="contact"
                                    aria-selected="false">
                                    Summary
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
        
                <div class="tab-content" id="myTabContent">
                    {% if not customer %}
                    <div class="tab-pane fade show active" id="customerSection" role="tabpanel" aria-labelledby="">
                        <div class="masterSearchWrap">
                            
                                {% if customer %}
                                <div class="formPlate mb-4">
                                    <div class="titleWrap">
                                        <h3>
                                            Customer Details
                                        </h3>
                                    </div>
                                    <div class="dataRow">
                                        <div class="row">
                                            <div class="col-2">
                                                <span>
                                                    {{ customer.user_id }}
                                                </span>
                                            </div>
                                            <div class="col-3">
                                                <span>
                                                    {{ customer.first_name }} {{ customer.last_name }}
                                                </span>
                                            </div>
                                            <div class="col-3">
                                                <span>
                                                    {{ country.code }} - {{ customer.phone_number }}
                                                </span>
                                            </div>
                                            <div class="col-4">
                                                <span>
                                                     {{ country.email }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <h2>Search Existing Customer</h2>
                                <form action="{% url 'orders:order_submission' %}"
                                    class="user_input_form" method="post">{% csrf_token %}                            
                                        <input id="inputOrigin" class="form-control form-control-lg" type="text" 
                                            placeholder="Search - Customer, Order"
                                            name="user_input" aria-label=".form-control-lg example">
                                </form>
                            
                                <div class="resultsWrapper">
                                    <div class="resultsLabels">
                                        <div class="resultLabel idLabel">
                                            <span>ID</span>
                                        </div>
                                        <div class="resultLabel nameLabel">
                                            <span>Name</span>
                                        </div>
                                        <div class="resultLabel phoneLabel">
                                            <span>Phone Number</span>
                                        </div>
                                        <div class="resultLabel emailLabel">
                                            <span>Email ID</span>
                                        </div>
                                    </div>

                                    <div class="resultDatas">
                                        <a href="#">
                                            <div class="resultData idData">
                                                <span>DD 123</span>
                                            </div>
                                            <div class="resultData nameData">
                                                <span>Name Surname</span>
                                            </div>
                                            <div class="resultData phoneData">
                                                <span>+971 9876543210</span>
                                            </div>
                                            <div class="resultData emailData">
                                                <span>emailid@domain.com</span>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="resultDatas">
                                        <a href="#">
                                            <div class="resultData idData">
                                                <span>DD 123</span>
                                            </div>
                                            <div class="resultData nameData">
                                                <span>Name Surname</span>
                                            </div>
                                            <div class="resultData phoneData">
                                                <span>+971 9876543210</span>
                                            </div>
                                            <div class="resultData emailData">
                                                <span>emailid@domain.com</span>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="resultDatas">
                                        <a href="#">
                                            <div class="resultData idData">
                                                <span>DD 123</span>
                                            </div>
                                            <div class="resultData nameData">
                                                <span>Name Surname</span>
                                            </div>
                                            <div class="resultData phoneData">
                                                <span>+971 9876543210</span>
                                            </div>
                                            <div class="resultData emailData">
                                                <span>emailid@domain.com</span>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="resultDatas">
                                        <a href="#">
                                            <div class="resultData idData">
                                                <span>DD 123</span>
                                            </div>
                                            <div class="resultData nameData">
                                                <span>Name Surname</span>
                                            </div>
                                            <div class="resultData phoneData">
                                                <span>+971 9876543210</span>
                                            </div>
                                            <div class="resultData emailData">
                                                <span>emailid@domain.com</span>
                                            </div>
                                        </a>
                                    </div>

                                </div>
                            {% endif %}
                            <h3 class="mt-4">OR</h3>
                        </div>
                         
                        <div class="formPlate ">
                            <div class="titleWrap">
                                <h3>
                                    Add New Customer
                                </h3>
                            </div>
                            <div class="formWrap">
                                <form action="" class="form_primary_step1" method="post"
                                        id="id_form_primary_step1">{% csrf_token %}
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">First Name</label>
                                                <input name="first_name" type="text" class="form-control" id="fname" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Last Name</label>
                                                <input name="last_name" type="text" class="form-control" id="lname" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Email ID</label>
                                                <input name="email" type="email" class="form-control" id="email" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Contact Number</label>
                                                <input name="phone_number" type="number" class="form-control phone" id="phone" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Place</label>
                                                <input name="place" type="text" class="form-control" id="place" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Area</label>
                                                <input name="area" type="text" class="form-control" id="area" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Address</label>
                                                <textarea name="address" id="" cols="30" rows="5"></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Notes</label>
                                                <textarea name="notes" id="" cols="30" rows="5"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="actionPlate step1">
                            <div class="row">
                                <div class="col-6">
                                    <button class="secondary step1-cancel" type="button">Cancel</button>
                                </div>
                                <div class="col-6">
                                    <button class="primary step1-next" type="button">Next</button>
                                </div>
                            </div>
                        </div>
                        

                    </div>
                    {% endif %}
                    <div class="tab-pane fade" id="orderSection" role="tabpanel" aria-labelledby="">
                        <div class="formPlate mb-4">
                            <div class="titleWrap">
                                <h3>
                                    Customer Details
                                </h3>
                            </div>
                            {% if customer %}
                            <div class="dataRow">
                                <div class="row">
                                    <div class="col-2">
                                        <span>
                                             {{ customer.user_id }}
                                        </span>
                                    </div>
                                    <div class="col-3">
                                        <span>
                                            {{ customer.first_name }} {{ customer.last_name }}
                                        </span>
                                    </div>
                                    <div class="col-3">
                                        <span>
                                            {{ country.code }} - {{ customer.phone_number }}
                                        </span>
                                    </div>
                                    <div class="col-4">
                                        <span>
                                                {{ country.email }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="dataRow step2-tab">
                                <div class="row">
                                    <div class="col-2">
                                        <span class="user_id_spn">
                                        </span>
                                    </div>
                                    <div class="col-3">
                                        <span  class="user_name_spn">
                                        </span>
                                    </div>
                                    <div class="col-3">
                                        <span class="user_phone_spn">
                                        </span>
                                    </div>
                                    <div class="col-4">
                                        <span class="user_email_spn">
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="formPlate">
                            <div class="titleWrap">
                                <h3>
                                    Add Order Details
                                </h3>
                            </div>
                            <div class="formWrap">
                                <form action="" class="form_primary_step2" method="post"
                                        id="id_form_primary_step2">{% csrf_token %}
                                    <input name="session_customer" type="hidden" class="form-control" id="id_session_customer">
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Customer Own Fabric?</label>
                                                <div class="checkWrap">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" value="Yes">
                                                        <label class="form-check-label" for="flexRadioDefault1">
                                                          Yes
                                                        </label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked value="No">
                                                        <label class="form-check-label" for="flexRadioDefault2">
                                                          No
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-md-6"></div>
                                        
                                        
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Quantity *</label>
                                                <input name="qty" type="number" class="form-control" id="qty" placeholder="Quantity">

                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Delivery Date *</label>
                                                <input name="ddate" type="date" class="form-control" id="" placeholder="">
                                            </div>
                                        </div>
                                        
                                    
                                         
                                    </div>
                                </form>
                            </div>
                        </div>
          
                        <div class="actionPlate step2">
                            <div class="row">
                                <div class="col-6">
                                    <button class="secondary step2-cancel">Back</button>
                                </div>
                                <div class="col-6">
                                    <button class="primary step2-next">Next</button>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="tab-pane fade" id="measurementSection" role="tabpanel" aria-labelledby="">
                        <input name="session_quantity" type="hidden" class="form-control" id="id_session_quantity">
                        
                        
                        <div class="actionPlate step3">
                            <div class="row">
                                <div class="col-6">
                                    <button class="secondary step3-cancel">Back</button>
                                </div>
                                <div class="col-6">
                                    <button class="primary step3-next">Next</button>
                                </div>
                            </div>
                        </div>
                     </div>
                    <div class="tab-pane fade" id="summarySection" role="tabpanel" aria-labelledby="">
                        <div class="formPlate ">
                            <div class="titleWrap">
                                <div class="row">
                                    <div class="col-sm-8">
                                        <h3>
                                            Customer Details
                                        </h3>
                                    </div>
                                    <div class="col-sm-4">
                                        <h3 class="text-end">
                                            <span class="customer_id_summary">
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <div class="formWrap">
                                <form action="">
                                    <div class="row">
                                        <div class="col-12">
                                            <h4>Customer Details</h4>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="dataGroup">
                                                <label class="form-label">Customer Name</label>
                                                <div class="form-control">
                                                    <span  class="customer_name_summary"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="dataGroup">
                                                <label class="form-label">Mobile Number</label>
                                                <div class="form-control">
                                                    <span  class="customer_phone_summary"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3"></div>
                                        <div class="col-12">
                                            <h4>Order Details</h4>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="dataGroup">
                                                <label class="form-label">Fabric Type</label>
                                                <div class="form-control">
                                                    <span  class="fab_typ_summary"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="dataGroup">
                                                <label class="form-label">Tailoring Style</label>
                                                <div class="form-control">
                                                    <span  class="tailr_styl_summary"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="dataGroup">
                                                <label class="form-label">Total Meters</label>
                                                <div class="form-control">
                                                   <span  class="totl_meters_summary"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="dataGroup">
                                                <label class="form-label">Quantity</label>
                                                <div class="form-control">
                                                    <span  class="qty_summary"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="dataGroup">
                                                <label class="form-label">Delivery Date</label>
                                                <div class="form-control">
                                                    <span  class="deliver_dt_summary"></span>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                               
                                </form>
                            </div>
                        </div>
                        
                        <div class="actionPlate step2">
                            <div class="paymentSelections">
                                <div class="formPlate">
                                    <div class="titleWrap">
                                        <h3>Payment Option</h3>
                                    </div>
                                    <form action="" class="form_primary_summary" method="post"
                                        id="id_form_primary_summary">{% csrf_token %}
                                        <input name="session_complete_order" type="hidden" class="form-control" id="id_session_complete_order" value="">

                                        <div class="container">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="inputWrap">
                                                        <label for="" class="form-label">Payment Method</label>
                                                        <select name="pay_methd" id="paymentMethod" class="form-select">
                                                            <option value="PM1">Cash</option>
                                                            <option value="PM2">Credit Card</option>
                                                            <option value="PM3">Debit Card</option>
                                                            <option value="PM4">Pay Later</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="inputWrap">
                                                        <label for="" class="form-label">Amount</label>
                                                        <input type="number" class="form-control" id="id_summary_amount" placeholder="" name="pay_amount" value="0">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </form>
                                </div>
                            </div>
                            <div class="mb-2"></div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="totalData">
                                        <h4>
                                           Total - <span id="id_total_amount"></span> KWD
                                        </h4>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-2"></div>

                            <div class="row">
                                <div class="col-6">
                                    <button class="secondary">Back</button>
                                </div>
                                <div class="col-6">
                                    <button class="primary step4-summary">SUBMIT ORDER</button>
                                </div>
                            </div>
                        </div>
                     </div>
                  </div>
            </div>
        </div>
    </div>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
    <script type="module"  src="/static/js/all.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script  type="module">
        $(jQuery).ready(function() {


            $('#placeList').select2();
            $('#areaList').select2();
            $('#fabricType').select2();
            $('#tayloringType').select2();
            $('#totalMeters').select2();
            $('#totalQuantity').select2();
            $('#colorType').select2();
            $('#paymentMethod').select2();


            $('.sholderOne').select2();
            $('.sholderTwo').select2();
            $('.mainWidth').select2();
            $('.penPocket').select2();
            $('.insidePocket').select2();
            $('.handSize').select2();
 
           // $('#sholderOne2').select2();
            //$('#sholderTwo2').select2();
            //$('#mainWidth2').select2();
           // $('#penPocket2').select2();
           // $('#insidePocket2').select2();
          //  $('#handSize2').select2();



            const input = document.querySelector(".phone");
            window.intlTelInput(input, {
                        nationalMode: false,
                        autoHideDialCode: false,
                        initialCountry: 'kw',
                        preferredCountries: ''
            });

            document.querySelector('.select2-search__field').focus();


        });

        $(document).on('select2:open', () => {
            document.querySelector('.select2-search__field').focus();
        });

        //custom
        $(document).ready(function(){
            {% if customer %}
                activaTab('orderSection');
            {% endif %}


            $(function() {
            $("#inputOrigin").autocomplete({
                source: "/origin_airport_search/",
                select: function (event, ui) { //item selected
                    AutoCompleteSelectHandler(event, ui)
                },
                minLength: 2,

            })
            .autocomplete( "instance" )._renderItem = function( ul, item ) {
                console.log(item)
                 return $( "<li>" )

                .append( "<div class='resultData idData'><span><i class='fas fa-id-badge'></i> " + item.id + "</span></div><div class='resultData nameData'><span><i class='fas fa-user'></i> " + item.first_name + "</span></div><div class='resultData phoneData'><span><i class='fas fa-phone-alt'></i> " + item.phone + "</span></div><div class='resultData emailData'><span><i class='fas fa-envelope'></i> " + item.email + "</span></div>" )
                .appendTo( ul );
            };
        });

      

        function AutoCompleteSelectHandler(event, ui)
        {
            var selectedObj = ui.item;
            console.table(selectedObj)
            $(".btn_next_step1").trigger("click");
            $(".step2-tab .user_id_spn").text(ui.item.user_id);
            $(".step2-tab .user_name_spn").text(ui.item.first_name+" "+ui.item.last_name);
            $(".step2-tab .user_phone_spn").text(ui.item.phone);
            $(".step2-tab .user_email_spn").text(ui.item.email);
            $("#fname").val(ui.item.first_name);
            $("#lname").val(ui.item.last_name);
            $("#email").val(ui.item.email);
            $("#phone").val(ui.item.phone);
            $("#id_session_customer").val(ui.item.user_id);



        }


        });

        function activaTab(tab){
            //$('.nav-tabs a[href="#' + tab + '"]').tab('show');
            $("#order-tab").trigger("click");
        };

       // $(".step1 .cancel").click(function(){
         //   window.location.assign("/"); 
       // })

       //Form Validation
        $(function() {
            $("#id_form_primary_step1").validate({
                rules: {
                    first_name: "required",
                    last_name: "required",
                    email: {
                        required: true,
                        email: true
                    },
                    phone_number: {
                        required: true,
                        minlength: 5
                    }
                },
                // Specify validation error messages
                messages: {
                    first_name: "Please enter your firstname",
                    last_name: "Please enter your lastname",
                    phone_number: {
                        required: "Please provide a phone_number",
                        minlength: "Your phone number must be at least 5 digits long"
                    },
                    email: "Please enter a valid email address"
                },
                // Make sure the form is submitted to the destination defined
                // in the "action" attribute of the form when valid
                submitHandler: function(form) {
                    form.submit();
                }
            });

            $("#id_form_primary_step2").validate({
                rules: {
                    qty: "required",
                    ddate: "required",

                },
                // Specify validation error messages
                messages: {
                    qty: "Please enter a valid quantity",
                    ddate: "Please enter a valid delivery date"
                },
                // Make sure the form is submitted to the destination defined
                // in the "action" attribute of the form when valid
                submitHandler: function(form) {
                    form.submit();
                }
            });

            $("#id_form_primary_summary").validate({
                rules: {
                    pay_amount: "required",
                    pay_methd: "required",
                    

                },
                // Specify validation error messages
                messages: {
                    pay_amount: "Please enter amount to Pay",
                    pay_methd: "Please select Payment Method",

                   
                },
                // Make sure the form is submitted to the destination defined
                // in the "action" attribute of the form when valid
                submitHandler: function(form) {
                    form.submit();
                }
            });

            


        }); 

       $(function(){
            $('.step1-cancel').click(function (e) {
                window.location.assign("/");
            });        
            $('.step1-next').click(function (e) {
                e.preventDefault();
                var $form = $("#id_form_primary_step1");

                // check if the input is valid using a 'valid' property
                if (!$form.valid()) return false;

                $.ajax({
                        type: "POST",
                        enctype: 'multipart/form-data',
                        url: "/orders/ajax/submission/",
                        data: $("#id_form_primary_step1").serialize(),
                        success: function (data) {
                            console.log("SUCCESS : ", data);
                            $(".btn_next_step1").trigger("click");
                            $(".step2-tab .user_id_spn").text(data['data']['user_id']);
                            $(".step2-tab .user_name_spn").text(data['data']['first_name']+" "+data['data']['last_name']);
                            $(".step2-tab .user_phone_spn").text("+971 "+data['data']['phone_number']);
                            $(".step2-tab .user_email_spn").text(data['data']['email']);
                            $("#id_session_customer").val(data['data']['user_id']);
                            
                        },
                        error: function (e) {
                            $(this).prop("disabled", false);    
                            console.log("ERROR : ", e);
                        }
                    });
                });
                $('.step2-next').click(function (e) {
                    e.preventDefault();
                    var $form = $("#id_form_primary_step2");

                    // check if the input is valid using a 'valid' property
                    if (!$form.valid()) return false;

                    $.ajax({
                            type: "POST",
                            enctype: 'multipart/form-data',
                            url: "/orders/ajax/orderbook/crud/",
                            data: $("#id_form_primary_step2").serialize(),
                            success: function (data) {
                                console.log("SUCCESS : ", data);
                                $(".btn_next_step2").trigger("click");
                                $("#id_session_quantity").val( data['data']['qty']);
                
                                var order_html='';
                                for(var i = 1; i <= data['data']['qty']; i++) {
                                    var j = i-1;

                                order_html += `<form action="" class="form_measurement" method="post"
                                        id="id_form_measurement_`+i+`">{% csrf_token %}
                                        <div class="formPlate orderFormset`+i+` mb-4">
                            <div class="titleWrap">
                                <h3>
                                    Order `+i+` - Measurements
                                    <input name="session_measure_user" type="hidden" class="form-control" id="id_session_measure_user`+i+`" value="`+ data['data']['user']['user_id'] +`">
                                    <input name="session_measure_order" type="hidden" class="form-control" id="id_session_measure_order`+i+`" value="`+ data['data']['data'][j]['id'] +`">
                                    <input name="session_measure_complete_order" type="hidden" class="form-control" id="id_session_measure_complete_order`+i+`" value="`+ data['data']['complete_order_id'] +`">

                                </h3>
                            </div>
                            <div class="dataRow">
                                <div class="row">
                                    <div class="col-12">
                                        <span>Customer ID: <span  class="user_id_spn"><b>`+ data['data']['user']['user_id'] +`</b></span></span>
                                    </div>
                                    <div class="col-12">
                                        <span>Order ID: <span  class="order_id_spn"><b>`+ data['data']['data'][j]['id'] +`</b></span></span>
                                    </div>
                                    <div class="col-12">
                                        <span>Store Location: <span  class="branch_id_spn"><b>`+ data['data']['branch_title'] +`</b></span></span>
                                    </div>
                                    <div class="container">
                                        <hr>
                                    </div>
                                    <div class="col-4">
                                        <span>Deliver date: <span  class="order_dt_spn"><b>`+ data['data']['data'][j]['deliver_at'] +`</b></span></span>
                                    </div>
                                    <div class="col-4 text-center">
                                        <span>Q.of pieces: <br> <span  class="quantity_dt_spn"><b>`+ data['data']['data'][j]['quantity'] +`</b></span></span> <br>
                                    </div>
                                    <div class="col-4 ">
                                        <span>Name: <span  class="customer_name_dt_spn"><b>`+ data['data']['user']['first_name'] +`</b></span></span> <br>
                                        <span>Phone Number: <span  class="customer_phone_dt_spn"><b>`+ data['data']['user']['phone_number'] +`</b></span></span> <br>
                                        <span>Address: <span  class="customer_address_dt_spn"><b>`+ data['data']['user']['address'] +`</b></span></span> <br>
                                    </div>
                                    <div class="container">
                                        <hr>
                                    </div>

                                            <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Fabric Type *</label>
                                                <select name="fabricTypes" id="fabricType" class="form-select">
                                                    <option value="">Select fabric type</option>
                                                    {% for item in fbtype %}
                                                    <option value="{{ item.id }}">{{ item.title }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Tayloring Style *</label>
                                                <select name="tayloringType" id="tayloringType" class="form-select">
                                                    <option value="">Select Style</option>
                                                    {% for item in tailstyle %}
                                                    <option value="{{ item.pk }}">{{ item.title }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Color *</label>
                                                <select name="color" id="colors_id" class="form-select">
                                                    <option value="">Select Color</option>
                                                    {% for item in colors %}
                                                    <option value="{{ item.pk }}">{{ item.name }}</option>
                                                    {% endfor %}
                                                </select>

                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="inputWrap">
                                                <label for="" class="form-label">Total meters *</label>
                                                <input name="meters" type="number" class="form-control" id="meters" placeholder="Total meters">

                                            </div>
                                        </div>
                                        <div class="container">
                                            <hr>
                                        </div>

                                    
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="collorWrap">
                                                    <img src="/static/images/measurements/img2.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="collar" id="collar1" value="C1" checked="">
                                                        <input class="form-check-input" type="radio" name="collar" id="collar2" value="C2">
                                                        <input class="form-check-input" type="radio" name="collar" id="collar3" value="C3">
                                                        <input class="form-check-input" type="radio" name="collar" id="collar4" value="C4">
                                                    </div>
                                                </div>
  
                                            </div>


                                            <div class="col-sm-6">
                                                <div class="zipWrap">
                                                    <img src="/static/images/measurements/img5.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="zip" id="zip1" value="Z1" checked="">
                                                        <input class="form-check-input" type="radio" name="zip" id="zip2" value="Z2">
                                                        <input class="form-check-input" type="radio" name="zip" id="zip3" value="Z3">
                                                        <input class="form-check-input" type="radio" name="zip" id="zip4" value="Z4">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mb-1"></div>
                                            <div class="col-sm-6">
                                                <div class="zipWrap">
                                                    <div class="mb-1"></div>
                                                    <img src="/static/images/measurements/img6.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="pocket" id="pocket1" value="P1" checked="">
                                                        <input class="form-check-input" type="radio" name="pocket" id="pocket2" value="P2">
                                                        <input class="form-check-input" type="radio" name="pocket" id="pocket3" value="P3">
                                                        <input class="form-check-input" type="radio" name="pocket" id="pocket4" value="P4">
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="col-sm-6">
                                                <div class="pocketTwo">
                                                    <div class="mb-1"></div>
                                                    <img src="/static/images/measurements/img8.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="pocketTwo" id="pocketTwo1" value="P21"  checked="">
                                                        <input class="form-check-input" type="radio" name="pocketTwo" id="pocketTwo2" value="P22">
                                                        <input class="form-check-input" type="radio" name="pocketTwo" id="pocketTwo3" value="P23">
                                                        <input class="form-check-input" type="radio" name="pocketTwo" id="pocketTwo4" value="P24">
                                                        <input class="form-check-input" type="radio" name="pocketTwo" id="pocketTwo5" value="P25">
                                                        <input class="form-check-input" type="radio" name="pocketTwo" id="pocketTwo6" value="P26">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mb-3"></div>

                                            <div class="col-sm-6">
                                                <div class="tieWrap">
                                                    <img src="/static/images/measurements/img7.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie1" value="T1"  checked="">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie2" value="T2">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie3" value="T3">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie4" value="T4">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie5" value="T5">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie6" value="T6">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie7" value="T7">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie8" value="T8">
                                                        <input class="form-check-input" type="radio" name="tie" id="tie9" value="T9">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="penPocket">
                                                    <img src="/static/images/measurements/penPocket.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="penpocket" id="penpocket1" value="PP1"  checked="">
                                                        <input class="form-check-input" type="radio" name="penpocket" id="penpocket2" value="PP2">
                                                        <input class="form-check-input" type="radio" name="penpocket" id="penpocket3" value="PP3">
                                                        <input class="form-check-input" type="radio" name="penpocket" id="penpocket4" value="PP4">
                                                        <input class="form-check-input" type="radio" name="penpocket" id="penpocket5" value="PP5">
                                                        <input class="form-check-input" type="radio" name="penpocket" id="penpocket6" value="PP6">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mb-3"></div>

                                            <div class="col-sm-6">
                                                <div class="sizeMap">
                                                    <div class="sholderOne">
                                                        <select name="sholderOne" id="sholderOne`+i+`">
                                                            <option value="1.00">1.00</option>
                                                            <option value="1.2">1.25</option>
                                                            <option value="1.50">1.50</option>
                                                            <option value="1.75">1.75</option>
                                                            <option value="2.00">2.00</option>
                                                        </select>
                                                    </div>
                                                    <div class="sholderTwo">
                                                        <select name="sholderTwo" id="sholderTwo`+i+`">
                                                            <option value="1.00">1.00</option>
                                                            <option value="1.2">1.25</option>
                                                            <option value="1.50">1.50</option>
                                                            <option value="1.75">1.75</option>
                                                            <option value="2.00">2.00</option>
                                                        </select>
                                                    </div>

                                                    <div class="mainWidth">
                                                        <select name="mainWidth" id="mainWidth`+i+`">
                                                            <option value="1.00">1.00</option>
                                                            <option value="1.2">1.25</option>
                                                            <option value="1.50">1.50</option>
                                                            <option value="1.75">1.75</option>
                                                            <option value="2.00">2.00</option>
                                                        </select>
                                                    </div>

                                                    <div class="penPocket">
                                                        <select name="penPocket" id="penPocket`+i+`">
                                                            <option value="1.00">1.00</option>
                                                            <option value="1.2">1.25</option>
                                                            <option value="1.50">1.50</option>
                                                            <option value="1.75">1.75</option>
                                                            <option value="2.00">2.00</option>
                                                        </select>
                                                    </div>
                                                    <div class="insidePocket">
                                                        <select name="insidePocket" id="insidePocket`+i+`">
                                                            <option value="1.00">1.00</option>
                                                            <option value="1.2">1.25</option>
                                                            <option value="1.50">1.50</option>
                                                            <option value="1.75">1.75</option>
                                                            <option value="2.00">2.00</option>
                                                        </select>
                                                    </div>
                                                    <div class="handSize">
                                                        <select name="handSize" id="handSize`+i+`">
                                                            <option value="1.00">1.00</option>
                                                            <option value="1.2">1.25</option>
                                                            <option value="1.50">1.50</option>
                                                            <option value="1.75">1.75</option>
                                                            <option value="2.00">2.00</option>
                                                        </select>
                                                    </div>
                                                    <img src="/static/images/measurements/1.png" alt="">
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="mb-3"></div>
                                        
                                                <div class="cuffLink">
                                                    <img src="/static/images/measurements/cuffLink1.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="cufflink" id="cufflink1" value="CL1" checked="">
                                                        <input class="form-check-input" type="radio" name="cufflink" id="cufflink2" value="CL2">
                                                        <input class="form-check-input" type="radio" name="cufflink" id="cufflink3" value="CL3">
                                                        <input class="form-check-input" type="radio" name="cufflink" id="cufflink4" value="CL4">
                                                    </div>
                                                </div>
                                                <div class="mb-3"></div>

                                                <div class="cuffLink">
                                                    <img src="/static/images/measurements/cuffLink2.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="cufflink" id="cufflink5" value="CL5"  checked="">
                                                        <input class="form-check-input" type="radio" name="cufflink" id="cufflink6" value="CL6">
                                                        <input class="form-check-input" type="radio" name="cufflink" id="cufflink7" value="CL7">
                                                        <input class="form-check-input" type="radio" name="cufflink" id="cufflink8" value="CL8">
                                                    </div>
                                                </div>
                                                <div class="mb-3"></div>


                                                <div class="insidePocketShape">
                                                    <img src="/static/images/measurements/insidePocketShape.png" alt=""> <br>
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="insidePocketShape" id="insidePocketShape1" value="IPS1"  checked="">
                                                        <input class="form-check-input" type="radio" name="insidePocketShape" id="insidePocketShape2" value="IPS2">
                                                    </div>
                                                </div>
                                                <div class="mb-3"></div>
                                                <div class="buttons">
                                                    <img src="/static/images/measurements/buttons.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="buttons" id="buttons1" value="BTN1" checked="">
                                                        <input class="form-check-input" type="radio" name="buttons" id="buttons2" value="BTN2">
                                                        <input class="form-check-input" type="radio" name="buttons" id="buttons3" value="BTN3">
                                                        <input class="form-check-input" type="radio" name="buttons" id="buttons4" value="BTN4">
                                                        <input class="form-check-input" type="radio" name="buttons" id="buttons5" value="BTN5">
                                                    </div>
                                                </div>
                                                <div class="mb-3"></div>
                                                <div class="finalStyle">
                                                    <img src="/static/images/measurements/finalStyle.png" alt="">
                                                    <div class="inputGroup">
                                                        <input class="form-check-input" type="radio" name="finalStyle" id="finalStyle1" value="FS1"  checked="">
                                                        <input class="form-check-input" type="radio" name="finalStyle" id="finalStyle2" value="FS2" >
                                                        <input class="form-check-input" type="radio" name="finalStyle" id="finalStyle3" value="FS3" >
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3"></div>

                                        <div class="row">
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Width Collar</label>
                                                    <input type="text" class="form-control" name="width_collar">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Size Collar</label>
                                                    <input type="text" class="form-control"  name="size_collar">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Shoulder</label>
                                                    <input type="text" class="form-control" name="shoulder">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Front Chest</label>
                                                    <input type="text" class="form-control" name="front_chest">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3"></div>
                                        <div class="row">
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Bar</label>
                                                    <input type="text" class="form-control" name="bar">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Sleeve Length</label>
                                                    <input type="text" class="form-control" name="sleeve_length">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Front Pocket</label>
                                                    <input type="text" class="form-control" name="front_pocket">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Side Pocket</label>
                                                    <input type="text" class="form-control"name="size_pocket">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3"></div>
                                        <div class="row">
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Open Pocket</label>
                                                    <input type="text" class="form-control" name="big_pocket">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Fold Width</label>
                                                    <input type="text" class="form-control" name="fold_width">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Fold Length</label>
                                                    <input type="text" class="form-control" name="fold_length">
                                                </div>
                                            </div>
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Two Line</label>
                                                    <input type="text" class="form-control" name="two_line">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3"></div>

                                        <div class="row">
                                            <div class="col-3">
                                                <div class="inputWrap">
                                                    <label for="" class="form-label">Length</label>
                                                    <input type="text" class="form-control" name="length">
                                                </div>
                                            </div>
                                        </div>


                                </div>
                            </div>
                        </div>
                        <div class="mb-3"></div></form>`

                                     $('#sholderOne'+i).select2();
                                    $('#sholderTwo'+i).select2();
                                    $('#mainWidth'+i).select2();
                                    $('#penPocket'+i).select2();
                                    $('#insidePocket'+i).select2();
                                    $('#handSize'+i).select2();
                                }
                                $('#measurementSection').append(order_html);                                

                            },
                            error: function (e) {
                                $(this).prop("disabled", false);    
                                console.log("ERROR : ", e);
                            }
                        });
                    });


                    //Step Measurement submission
                    $('.step3-next').click(function (e) {
                        e.preventDefault();

                                    
                        var qty = $("#id_session_quantity").val();
                        var validforms = 0
                        for(var i = 1; i <= qty; i++) {
                            var $form = $("#id_form_measurement_"+i);

                            $form.validate({
                                rules: {
                                fabricTypes: "required",
                                tayloringType: "required",
                                meters:"required",
                                color: {
                                    required: true
                                },
                                },
                                // Specify validation error messages
                                messages: {
                                    fabricTypes: "Please enter amount to Pay",
                                    tayloringType: "Please enter amount to Pay",
                                    meters: "Please enter amount to Pay",
                                    color: {
                                        required: "Please provide color"
                                    },

                                
                                },
                                // Make sure the form is submitted to the destination defined
                                // in the "action" attribute of the form when valid
                                submitHandler: function(form) {
                                    form.submit();
                                }
                            });

                            if($form.valid()){
                                validforms = validforms + 1;
                            }
                        }
                        for(var i = 1; i <= qty; i++) {
                            var $form = $("#id_form_measurement_"+i);

                            if (!(validforms == qty )) return false
                            $.ajax({
                                type: "POST",
                                enctype: 'multipart/form-data',
                                url: "/orders/ajax/measurement/crud/",
                                data: $form.serialize(),
                                success: function (data) {
                                    console.log("SUCCESS : ", data);  
                                    $(".btn_next_step3").trigger("click");

                                    $(".customer_id_summary").text(data['data']['customer']['user_id']);
                                    $(".customer_name_summary").text(data['data']['customer']['first_name']+" "+data['data']['customer']['last_name']);
                                    $(".customer_phone_summary").text(data['data']['customer']['phone_number']);
                                    $(".fab_typ_summary").append(data['data']['fab_title']+", ");
                                    $(".tailr_styl_summary").append(data['data']['tailr_title']+", ");
                                    $(".totl_meters_summary").append(data['data']['total_meters']+", ");
                                    $(".qty_summary").text(data['data']['order']['quantity']);
                                    $(".deliver_dt_summary").text(data['data']['order']['deliver_at']);

                                    $("#id_summary_amount").val(data['data']['comp_ordr_obj']['total_amnt_to_pay']);
                                    $("#id_total_amount").text(data['data']['comp_ordr_obj']['total_amnt_to_pay']);
                                    $("#id_session_complete_order").val(data['data']['comp_ordr_obj']['id']);



                                },
                                error: function (e) {
                                    console.log("ERROR : ", e);
                                }
                            });

                        }
                    });


                    //Step Measurement submission
                    $('.step4-summary').click(function (e) {
                        e.preventDefault();
                        var complete_order_id =  $("#id_session_complete_order");
                        var $form = $("#id_form_primary_summary");

                        Swal.fire({
                                title: 'Are you sure?',
                                text: "Please confirm the amount and payment method.",
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Please proceed.'
                                }).then((result) => {
                                if (result.isConfirmed) {

                                    $.ajax({
                                        type: "POST",
                                        enctype: 'multipart/form-data',
                                        url: "/orders/ajax/order/creation/",
                                        data: $form.serialize(),
                                        success: function (data) {
                                            Swal.fire(
                                                'Order Placed successfully!',
                                                'Your order has been created..',
                                                'success'
                                                );
                                                window.location.href = "/print/"+data['data']['order_id'];

                                        },
                                        error: function (e) {
                                            console.log(e);
                                            Swal.fire({
                                                icon: 'error',
                                                title: 'Oops...',
                                                text: 'Something went wrong!',
                                                footer: e.status +"-"+ e.statusText
                                                })
                                        }
                                    });


                                    
                                }
                                })

                        

                    });
        });
        


        
 
    </script>
</body>
</html>